#!/usr/bin/python3

import r2pipe
import os

r = r2pipe.open()

os.system("rm report.md")
os.system("clear")

f = open("report.md", "a")
f.write("# Title goes here\n")

def main():
    print("Creating report")
    addExecutiveSummary()
    addBasicInfo()

def addStrings():
    pass

def addExecutiveSummary():
    print("Adding executive summary")
    installation = "This is some text here that might summarize some things or might not but either way it is interesting"
    persistence = installation
    behavior = persistence
    removal = behavior

    f.write("\n## Executive Summary\n")
    f.write("\n### Installation\n")
    f.write(installation)
    f.write("\n### Persistence\n")
    f.write(persistence)
    f.write("\n### Behavior\n")
    f.write(behavior)
    f.write("\n### Removal\n")
    f.write(removal)
    f.write("\n\n---\n\n")

def addBasicInfo():
    print("Adding basic info")
    filename = r.cmdj("ij")["core"]["file"]
    filesize = r.cmdj("ij")["core"]["size"]
    md5 = r.cmdj("itj")["md5"]
    sha1 = r.cmdj("itj")["sha1"]
    sha256 = r.cmdj("itj")["sha256"]
    arch = r.cmdj("ij")["bin"]["arch"]
    compiler = r.cmdj("ij")["bin"]["compiler"]
    static = r.cmdj("ij")["bin"]["static"]
    stripped = r.cmdj("ij")["bin"]["stripped"]

    f.write("""
| Field  | Data  |
|---|---|
| Filename  | """ + filename + """  |
| File Size  | """ + str(filesize) + """  bytes  |
| MD5  | """ + md5 + """ |
| SHA1  | """ + sha1 + """ |
| SHA256  | """ + sha256 + """ |
| Architecture  | """ + arch + """ |
| Compiler | """ + compiler + """ |
| Statically linked  | """ + str(static) + """ |
| Stripped  | """ + str(stripped) + """ |
    """)



def addFunctionInfo():
    for f in r.cmdj("aflj"):
        name = f["name"]
        r.cmd("s " + name)
        comment = r.cmd("pd 1").split("\n")[-1].split(";")[-1]
        
        if comment:
            f.write("Found comment")

        
    
main()

f.close()

os.system("cat report.md")
